threefish_encrypt is a command-line interface (CLI) tool built in Rust for encrypting and decrypting files using the Threefish-256 block cipher in CTR (Counter) mode, enhanced with CMAC (Cipher-based Message Authentication Code) for integrity and authenticity verification. It operates on files located in the same directory as the executable, requiring a single argument: the filename to process (e.g., ./threefish_encrypt myfile.txt). The tool automatically detects whether to encrypt or decrypt based on the presence of a magic header ("TF256ENC" as 8 bytes) at the start of the fileâ€”if present, it decrypts; otherwise, it encrypts. For encryption, it generates a random 16-byte initialization vector (IV), encrypts the plaintext, computes a 32-byte CMAC tag over the header, IV, and ciphertext using the same cipher, and structures the output as header + IV + ciphertext + tag. For decryption, it extracts the IV and tag, verifies the CMAC (failing if tampered or wrong key), and decrypts the ciphertext. All operations are performed in-place with atomic overwrite via a temporary file to prevent data loss, and it relies on a fixed 32-byte key stored in a file named "key.bin" in the executable's directory (generate one securely, e.g., via openssl rand -out key.bin 32). The tool uses dependencies like threefish (0.5), cipher (0.4), clap (4.5 with derive), anyhow (1.0), rand (0.8), cmac (0.7), and crypto-mac (0.11) for robust error handling, argument parsing, randomness, and cryptographic primitives, ensuring secure usage for file protection while warning that users must safeguard the key file and noting it's not suitable for extremely large files due to in-memory processing.


Threefish-256 provides a high level of security, aiming for 256-bit strength similar to AES-256, with no practical breaks on the full cipher and design features that resist timing attacks better than AES in some software contexts due to its ARX (addition-rotation-XOR) structure without S-boxes or lookups. While reduced-round attacks exist (e.g., distinguishers up to 53 of 72 rounds), the full 72-round version remains unbroken, placing its theoretical security on par with AES and ChaCha20, both of which also lack full-round breaks. However, AES and ChaCha20 have undergone more extensive real-world scrutiny and deployment (e.g., in TLS), making them slightly more "battle-tested," though Threefish shares design philosophies with ChaCha20 and is considered more capable than AES in tweakable modes according to some analyses. In practice, all three are secure for most uses, but ChaCha20 often edges out in software speed and resistance to certain side-channel attacks, while AES benefits from hardware acceleration.
